---
layout: post
title: Set up linux environment on ERISOne
---

ERISOne is a "computing cluster with a job scheduling system for batch jobs, remote desktops for graphical applications and GPUs running on a Linux OS" maintained by Partners Healthcare.

Ideally, users do not need to purchase and maintain compute workstations. Rather, we use Macbooks to connect to a cluster behind the Partners firewall, This is ideal for working on a shared data repository, especially since we analyze PHI.

Unfortunately, setting up a modern data science stack on ERISOne is challenging. Many software packages are old, and obtaining desired memory, GPU, and CPU resources on a compute node requires additional steps.

This guide walks you through setup of Zsh, git, and other basic tools. It assumes you requested and have an ERISOne account, and connect via SSH ([see RISC guide here](https://rc.partners.org/kb/article/2814)).

## Change shell to `zsh`

ERISOne comes with `zsh` 4.3.11. Users on ERISOne do not have root and cannot use `chsh`, so we have to use a hack to make `zsh` the default shell.

Update `.bash_profile`:

```
echo 'export PATH=$HOME/local/bin:$PATH
      export SHELL=`which zsh`' >> ~/.bash_profile
      [ -f "$SHELL" ] && exec "$SHELL" -l' >> ~/.bash_profile
```

`source ~.bash_profile` to make the changes take effect. Now, when you log in to ERISOne, the bash shell will load, then call the commands in `.bash_profile`, which runs `zsh`.

The next time you log in, you will be prompted to set up `zsh`. The prompt now looks different:

```zsh
[ab123@eris1n3]~% 
```

and your shell should look better:
![](/assets/zsh_erisone.png)

To set up dotfiles, a nice theme, and other tools, follow the steps in my [linux setup guide]({% link _posts/2019-11-22-linux-setup.md %}).

## Load `git`, `tmux`, & `vim` via `module`

If you cloned my dotfiles and set them up, then `.zshrc` loads `git`, `tmux`, and `vim`. But read more about why.

ERISOne has `git` 1.7.1 by default, which was released in 2010. Subsequent installation of `oh-my-zsh` involves a shell script that invokes `-c` in `git clone`, which was introduced in `git` 1.7.7. Thus, we must upgrade `git`.

You can install `git` from source, but there are many other dependencies, so doing it takes a lot of effort.

Instead we can get a somewhat recent version of `git` that is already installed, via `module`.

```zsh
module load git/2.17.0
```

You can check if a more recent version of `MODULE_NAME` is available via `module avail MODULE_NAME`.

## Install Anaconda

The newest version of Anaconda on ERISOne (via `module`) is `4.4.0-p3`, whereas the current Linux version is `4.8.3`. Ideally, one would use the existing Anaconda module on ERISOne and set up a new environment with the desired Python version and packages. Unfortunately, there is an error with older versions of Conda that prevents users from even creating new environments:

```
RemoveError: 'setuptools' is a dependency of conda and cannot be removed from conda's operating environment.
```

To set up the desired Python environment, install Miniconda following the instructions in my [linux setup guide]({% link _posts/2019-11-22-linux-setup.md %}).

Like most Linux machines, ERISOne uses the bash shell by default. Therefore Conda will modify `/.bashrc` with the appropriate path for you to call `conda`. However, only `/.bash_profile` is called when you log in to ERISOne.

To ensure Conda is on your path so you can call `conda`, source `/.bashrc` in `/.bash_profile`:

```bash
echo 'export source ~/.bashrc' >> ~/.bash_profile
```

After you install Anaconda, log out, and log back in ERISOne, your command line prompt should reflect that you are now using the base environment:

```bash
(base) -bash-4.1$ 
```

## Interactive session on compute node

Request a compute node on `interact-big` instead of running jobs on the login nodes (`eris1n2` or `eris1n3`):


```zsh
bsub -q interact-big -Is -XF -n 4 $HOME/local/bin/zsh
```

Read more about compute nodes on ERISOne [here](https://rc.partners.org/kb/article/2680).